@model ESUI.Models.LoginModel
<!DOCTYPE html>
@{
    ViewBag.TName = "Index";
}

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" charset="utf-8" src="~/Content/js/DictionaryHelper.js"></script>

    @*<script src="~/Scripts/Idcardvalidation.js"></script>*@
    @*<script src="~/Scripts/validata.js"></script>*@
    @* ReSharper disable once NotAllPathsReturnValue *@


    @section Jsprepare{

        <script type="text/javascript">
            @Html.Raw(ViewBag.RuteUrl)
         @Html.Raw(ViewBag.toolbar)

            var BaseUrl = "/Register/";
            jQuery(document).ready(function () {
                BindDepertment();
            });

            //实现的编辑，包括增查改
            function submitForm() {
                //判断按钮的信息是否通过验证
                var validate = $("#ff").form('validate');

                if (validate == false) {
                    return false;
                }
                //获取需要传递的参数传递给前台 push
                var postData = $("#ff").serializeArray();

                //发送异步请求到后台保存按钮数据
                $.post(BaseUrl + 'NewRegister', postData, function (data) {
                    alerts(data.Msg, 2);
                    if (data.Code > 0) {                       
                         setTimeout(login, 3);
                        // $("#ff").form("clear");
                    }
                });
            }

            function login() {
                var _uid = $("#LoginName").val(), _pwd = $("#Password").val();
                
                $.ajax({
                    url: BaseUrl + 'RegLogin',
                    type: 'POST',
                    data: { uid: _uid, pwd: _pwd },
                    cache: false,
                    error: function () { alert('Error $.ajax'); },
                    success: function (data) {

                    }
                });
            }

            function clearForm() {
                $('#ff').form('clear');
            }

            function BindDepertment() {
                $('#DepartmentId').combobox('reload', '/httpHandle/DictionaryHandler.ashx?action=GetDepartment');  // 使用新的URL重新载入列表数据
            }
        </script>
    }

</head>
<body>
    <div style="margin:0 auto;width:100%;text-align:center;">
        <div class="easyui-panel" title="新用户注册" style="left:0;right:0;min-width:600px;min-height:760px;">
            <form id="ff" class="easyui-form" method="post" data-options="novalidate:true">
                <table cellpadding="5" style="margin:100px auto 0px auto;border:none">
                    <tr>
                        <td>用户名:</td>
                        <td><input class="easyui-validatebox easyui-textbox" type="text" id="LoginName" name="LoginName" data-options="required:true" /></td>
                    </tr>
                    <tr>
                        <td>姓名:</td>
                        <td><input class="easyui-validatebox easyui-textbox" type="text" name="TrueName" data-options="required:true" /></td>
                    </tr>
                    <tr>
                        <td>身份证号:</td>
                        <td><input class="easyui-validatebox easyui-textbox" type="text" id="IdCard" name="IdCard" data-options="required:true" /></td>
                    </tr>
                    <tr>
                        <td>选择单位:</td>
                        <td>
                            <input id="DepartmentId" class="easyui-combobox" name="DepartmentId"
                                   data-options="valueField:'Id',textField:'TName'" />
                        </td>
                    </tr>
                    <tr>
                        <td>密码:</td>
                        <td><input class="easyui-validatebox easyui-textbox" type="password" id="Password" name="Password" data-options="required:true" /></td>
                    </tr>
                    <tr>
                        <td>确认密码:</td>
                        <td><input class="easyui-validatebox easyui-textbox" type="password" name="ConfirmPassword" data-options="required:true" /></td>
                    </tr>
                </table>
            </form>
            <div style="text-align:center;padding:5px">
                <a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">注册并登录</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">重置</a>
            </div>
        </div>
    </div>
</body>
</html>
